# Uniq

ru | [en (draft)](docs/README/README.en.md)

Удобное приложение расписаний для студентов МГТУ

## План работы

1. Инициализировать проект
   1. Настроить все 4 проекта (shared, collector, api, client)
   2. Добавить Docker Compose с 4 сервисами (collector, api, client, mongo, mongo-express)
2. Реализовать сервис для сбора данных
   1. Настроить TypeScript сервер и реализовать там запуск job'ы по таймеру
   2. Собирать данные с официальной страницы
   3. Предобрабатывать и группировать данные (объединять пары из расписания групп, если это общая лекция, СР или )
   4. В Mongo будут лежать объекты струтктуры (Предмет, время, неделя? (чс/зн), препод?, список групп без повторений, аудитория?). Данные о корпусе, курсе, детализацию группы и т.д. вычисляем динамически
   5. Потом, возможно, мы пересядем на АПИ Битопа
3. Реализовать сервис АПИ
   1. Заскаффолдить NestJS
   2. /api/scedule?groups&teacher&classroom&...
   3. /api/calendar/weeks
   4. Добавить Swagger
4. Реализовать моковую логику сервера для разработки летом
5. Реализовать веб-клиент
   1. Заскаффолдить приложение
   2. Настроить роутинг
   3. Релизовать сервисы API

## Руководство по стилю кода

1. Все компоненты, отрисовка которых управляется роутером, должны называть `<Feature>PageComponent`. Например, `ArchivePageComponent`
2. Все компоненты должны применять `changeDetection: ChangeDetectionStrategy.OnPush`. Там, где необходима стратегия обнаружения изменений по умолчанию, указывайте `easlint-disable...`
3. Структура модулей плоская. Все модули должны лежать в src/app/
4. Предпочтительно использовать lodash implicit chaining везде, где это возможно
5. При импорте сервисов в конструкторе следует всегда явно указывать модификаторы доступа, `readonly` и именовать без слова сервис. Одна строка - один параметр. Например:

    ```typescript
        constructor(
            private readonly _storage: StorageService,
        ) {}
    ```

6. Все `*ngFor` должны сопровождаться параметром `trackBy`. В большинстве случаев удобно использовать src/app/shared/utils/default-track-by.ts
7. Любые низкоуровневые сервисы, которые нельзя изолированно протестировать из UI, должны быть покрыты unit-тестами. Для компонентов также желательно писать unit-тесты.
8. Для всех высокоуровневых компонентов должны быть описаны e2e-тесты. К их написанию можно активно привлекать UI.
9. Для решения задач реализации пользовательских сценариев и обкспечения хорошего DX используй все возможоности TS и Angular: Generic Types, Type Guards, Function Overload, Observable и Promise, ООП, Directives, все возможности DI и т.д.
10. В большинстве случаев, чтобы сделать из холодоного `Observable` горячий, используй `shareReplayOneRefCount` из src/app/shared/utils/share-replay-one-ref.ts
11. Всецело избегай сохранения любых локальных стейтов. Старайся построить максимально реактивную архитектуру. Создавай неизменемые поля компонентов, хранящие потоки `Observable` вместо изменяемых полей, хранящих данные.
12. Типизируй, типизируй и ещё раз типизируй. Всегда думай о возможности использовать Generic, посмотеть на два шага вперёд и построить удобный DX. Чтобы API твоих сервисов и компонентов было удобно использовать.
13. По возможности минимизируй уровень вложенности кода. Разрешено использовать множественные return с этой целью. Хорошей практикой считается блок с проверкой корректности переданных аргументов и return/trow при недопустимых значениях в начале функции.
14. Поля для использования внутри класса помечаем нижним подчёркиванием (например `private _fieldName = null`). Поля, которые помечены `public` для использования в шаблоне, но которые не являются частью публичного API компонента также сопровождаются нижним подчёркиванием. Обычно к ним относятся внедренные в компонент через конструктор сервисы.
